window._ = require('lodash');

class LaravelData {
    
    constructor(data) {
        
        if(typeof window.Laravel.data == 'undefined') {
            window.Laravel.data = _.merge(this, data);
        } else {
            window.Laravel.data = _.merge(window.Laravel.data, data);
        }
        
        return window.Laravel.data;
  
    }
    
    /**
     * Save get LaravelData properties, if key is not set, return null
     * @param string key
     * @returns object
     */
    get(key) {
        if(this.hasOwnProperty(key)) {
            return this[key];
        }
        
        return null;
    }
    
    /**
     * Set/Update global LaravelData
     * @param string key
     * @param {type} value
     * @returns object
     */
    set(key, value) {
        if(this.hasOwnProperty(key)) {
           window.Laravel.data[key] = this[key] = value;
        }
        
        return;
    }
    
}

const VueLaravelData = {

    install(Vue) {

        window.Laravel.data = new LaravelData({});
        
        Vue.directive('laravel-data', (el, binding) => {
            window.Laravel.data = new LaravelData(binding.value);
        });
        
    }

}

export default VueLaravelData;